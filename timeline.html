<html>
	<head>
		<title>Sam + Zac :: Save the Date</title>
		<style type="text/css">
			* { margin: 0; padding: 0; }
			body { font-family: sans-serif; }
			.event { width: 100%; }
			.event h2 { margin-left: 10px; font-size: 80px; padding: 10px 0; }
			.event .timetrack { position: relative; height: 50px; width: 100%; overflow: hidden; }
			.event .timetrack .label, .event .timetrack .fill_label { position: absolute; font-size: 32px; line-height: 50px; bottom: 0; left: 10px; }
			.event .timetrack .label { z-index: 0; color: #000; }
			.event .timetrack .fill { z-index: 1; position: absolute; top: 0; left: 0; bottom: 0; width: 500px; background: #000; overflow: hidden; }
			.event .timetrack .fill_label { z-index: 2; color: #fff; width: 1000px; }
		</style>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
		<script type="html/template" id="event_template">
			<div class="event">
				<h2>{{title}}</h2>
				<div class="timetrack">
					<div class="label">{{timestamp}}</div>
					<div class="fill">
						<div class="fill_label">{{timestamp}}</div>
					</div>
				</div>
			</div>
		</script>
		<script type="text/javascript">
			var app = {
				events: [],
				colors: [
					// purple
					"#410d40",
					"#5c105b",
					"#760f75",
					// fuchsia
					"#870071",
					"#c12aa9",
					"#ed6fda",
					// blue
					"#006b9d",
					"#088ac6",
					"#04a3ed",
					// dark green
					"#5f8f00",
					"#7ab705",
					"#a3ef11",
					// lime green
					"#b3cd38",
					"rgb(224, 253, 89)",//"#e0fd59",
					"#eefbb2"
				],
				Event: function(title, timestamp) {
					this.title = title;
					this.timestamp = new Date(timestamp);
				},
				timeDifference: function(laterdate, earlierdate) {
					var difference = laterdate.getTime() - earlierdate.getTime();
					var past = true;
	    			if (difference < 0) {
	    				var past = false;
	    				difference = earlierdate.getTime() - laterdate.getTime();
	    			}
	    			var originalDifference = difference;
	    			var yearsDifference = Math.floor(difference/1000/60/60/24/365);
	    			difference -= yearsDifference*1000*60*60*24*365;
			    	var daysDifference = Math.floor(difference/1000/60/60/24);
	    			difference -= daysDifference*1000*60*60*24;
	    			var hoursDifference = Math.floor(difference/1000/60/60);
	    			difference -= hoursDifference*1000*60*60;
				    var minutesDifference = Math.floor(difference/1000/60);
	    			difference -= minutesDifference*1000*60;
	    			var secondsDifference = Math.floor(difference/1000);

	    			return {
	    				raw: originalDifference,
	    				years: yearsDifference,
	    				days: daysDifference,
	    				hours: hoursDifference,
	    				minutes: minutesDifference,
	    				seconds: secondsDifference,
	    				past: past
	    			}
				},
				getMaxDifference: function() {
					return this.timeDifference(new Date(), new Date("2005-08-20 00:00:00 MDT")).raw;
				},
				eventTemplate: function(event) {
					var contents = $("#event_template").html();
					contents = contents.replace("{{title}}", event.title);

					var difference = this.timeDifference(new Date(), event.timestamp);
					var timestring = (difference.past ? "" : "in ")
									 + difference.years
									 + " years "
									 + difference.days
									 + " days "
									 + difference.hours
									 + " hours "
									 + difference.minutes
									 + " minutes "
									 + difference.seconds
									 + " seconds"
									 + (difference.past ? " ago" : "");
					contents = contents.replace("{{timestamp}}", timestring);
					contents = contents.replace("{{timestamp}}", timestring);

					var $contents = $(contents);

					var fillPercent = difference.raw / this.getMaxDifference();
					$contents.find(".fill").css({"width": (fillPercent * 100) + "%" });

					return $contents;
				},
				render: function() {
					$("body").html("");
					var that = this;
					$.each(this.events, function(i, item){
						var itemHTML = that.eventTemplate(item);
						itemHTML.css({"background": that.colors[i]});
						$("body").append(itemHTML);
					});	
				},
				setup: function() {
					var Event = this.Event;
					this.events = [
						new Event("First Met", "2005-08-25 08:40:12 MDT"),
						new Event("First Date", "2005-09-30 19:20:53 MDT"),
						new Event("First Kiss", "2005-10-04 12:35:31 MDT"),
						new Event("First Fight", "2005-10-06 08:30:45 MDT"),
						new Event("Began Dating for Real", "2006-01-04 11:40:18 MDT"),
						new Event("Departed on First Trip Together", "2006-08-11 10:05:29 MDT"),
						new Event("Moved in Together", "2007-12-23 21:12:04 MDT"),
						new Event("First Rental Together", "2009-04-31 16:54:51 MDT"),
						new Event("First Condo Owned Together", "2010-05-31 14:30:34 MDT"),
						new Event("First International Trip to Paris", "2011-06-01 08:45:02 MDT"),
						new Event("Met Sam's Extended Family", "2011-07-01 23:25:40 MDT"),
						new Event("Met Zac's Extended Family", "2012-08-10 17:30:25 MDT"),
						new Event("Got Engaged", "2012-08-24 22:30:19 MDT"),
						new Event("Will get married", "2013-05-27 14:00:55 MDT")
					];
				}
			};

			app.setup();

			$(document).ready(function(){
				// app.render();
				var interval = setInterval(function(){ app.render() }, 1000);
			});
		</script>
	</head>
	<body>

	</body>
</html>
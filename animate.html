<html>
  <head>
    <title>Canvas tutorial</title>
    <script type="text/javascript">
      function boot() {
      	var canvas = document.getElementById('tutorial');
      	var width = canvas.width;
    	var center = width / 2;
    	var ctx = canvas.getContext('2d');

    	var randInt = function(scale) {
			return Math.ceil( Math.random() * scale );
		};

		var colors = [
      		"135,0,113", // pink
      		"65,13,64", // purple
      		"0,107,157", // blue
      		"95,143,0", // dark green
      		"179, 205, 56" // light green
      	];

      	var Circle = function(x, y, radius, color) {
      		this.x = x;
      		this.y = y;
      		this.radius = radius;
      		this.color = color;

      		this.draw = function(ctx) {
      			ctx.fillStyle = "rgb(" + this.color + ")";
	      		ctx.beginPath();
			    ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI, true);
			    ctx.fill();
			    ctx.fillStyle = "rgb(0,0,0)";
			    ctx.stroke();
			    ctx.arc(this.x, this.y, this.radius - 1, 0, 2 * Math.PI, true);
			    ctx.stroke();
      		};

      		this.translate = function(xOffset, yOffset) {
      			this.x = this.x + xOffset;
      			this.y = this.y + yOffset;
      		};

      		this.getLeftOffset = function() {
      			return this.x;
      		}

      		this.getRightOffset = function() {
      			return width - this.x;
      		}

      		this.goto = function(x, y, msec) {
      			var distance = Math.abs(x - this.x) + Math.abs(y - this.y);
      			var steps = distance / (msec - 500);

      			var interval = setInterval(function(){
					world.drift(20);
				}, 100);

				setTimeout(function(){
					clearInterval(interval);
				}, msec);
      		}
      	};

      	var CircleSet = function(circles) {
      		this.circles = circles;

      		this.draw = function(context) {
      			for (var i = circles.length - 1; i >= 0; i--) {
		      		circles[i].draw(context);
		      	};
      		}

      		this.translate = function(xOffset, yOffset) {
      			for (var i = this.circles.length - 1; i >= 0; i--) {
      				this.circles[i].translate(xOffset, yOffset);
      			};
      		}
      	}

      	var World = function(items) {
      		this.items = items;
      		this.groups = [[], []];
      		for (var i = items.length - 1; i >= 0; i--) {
  				this.groups[i % 2].push(items[i]);
	      	};

      		this.draw = function(context) {
      			context.clearRect(0, 0, 1200, 450);
      			for (var i = items.length - 1; i >= 0; i--) {
		      		items[i].draw(context);
		      	};
      		}

      		this.iterate = function() {
      			for (var i = items.length - 1; i >= 0; i--) {
      				var xShift = randInt(10) > 5 ? 1 : -1;
      				var yShift = randInt(10) > 5 ? 1 : -1;
		      		items[i].translate(xShift, yShift);
		      	};
      		}

      		this.drift = function(s) {
      			var speed = s || 1;
      			for (var i = this.groups[0].length - 1; i >= 0; i--) {
      				// group 1, left gravity
      				var item = this.groups[0][i];
      				item.translate(-speed, 0);
		      	};

		      	for (var i = this.groups[1].length - 1; i >= 0; i--) {
		      		// group 2, right gravity
      				var item = this.groups[1][i];
      				item.translate(speed, 0);
		      	};
      		}
      	};

      	var generateRings = function(x, y, baseColor) {
      		if (!baseColor) { baseColor = getColor() };
      		var pieces = baseColor.split(",");
      		pieces[0] = Number(pieces[0]);
      		pieces[1] = Number(pieces[1]);
      		pieces[2] = Number(pieces[2]);

      		var getScalingFactor = function() {
      			return 20 + randInt(20);
      		};

      		var darker = [
      			pieces[0] - getScalingFactor(),
      			pieces[1] - getScalingFactor(),
      			pieces[2] - getScalingFactor()
      		].join(",");

      		var lighter = [
      			pieces[0] + getScalingFactor(),
      			pieces[1] + getScalingFactor(),
      			pieces[2] + getScalingFactor()
      		].join(",");

      		return [
      			new Circle(x, y, 3 + randInt(7), lighter),
      			new Circle(x, y, 10 + randInt(10), baseColor),
      			new Circle(x, y, 20 + randInt(20), darker)
      		];
      	};

      	var generateWorld = function() {
      		var items = [];
			for (var i = width; i >= 0; i -= 14) {
            	var x = i;
             	var distanceFromCenterLine = Math.abs(x - center);
             	var nearbyCount = ((center - distanceFromCenterLine) - 1) / 100;

             	var colorForGroup;
              	if (true) {
                	var sectionWidth = width / 4;
	                if (x < sectionWidth) {
	                  colorForGroup = colors[0];
	                } else if (x < sectionWidth * 2) {
	                  colorForGroup = colors[1];
	                } else if (x < sectionWidth * 3) {
	                  colorForGroup = colors[2];
	                } else {
	                  colorForGroup = colors[3];
	                }
              	}

              	for (var j = nearbyCount; j >= 0; j--) {
                	var xloc = x - 20 + randInt(40);
                	var yloc = (j * (80 - (j * 3))) - 80 + randInt(120);

               		items.push(new CircleSet(generateRings(xloc, yloc, colorForGroup)));
              	};
            };  
            return items;
      	}

      	// var rings = generateRings(400, 100, "70, 200, 101");
      	// var circleSet = new CircleSet(rings);

      	// var circleSet2 = new CircleSet(generateRings(480, 90, "40, 80, 200"));

      	var world = new World(generateWorld());
		world.draw(ctx);

		// var interval = setInterval(function(){
		// 	world.drift(20);
		// 	world.draw(ctx);
		// }, 100);

		// setTimeout(function(){
		// 	clearInterval(interval);
		// }, 5000);
      }
    </script>
    <style type="text/css">
    	* { margin: 0; padding: 0; }
    	canvas { display: block; margin: 0 auto; }
      body { background: #fff; }
    	h1 { width: 800px; text-align: center; color: #fff; position: absolute; top: 100px; left: 50%; margin-left: -400px; font-family: "Jump", Gill Sans"; font-size: 100px; text-shadow: #000 1px 1px 1px; }
      h1 { width: 462px; height: 97px; text-indent: -9999px; background: url("./names.png") center center no-repeat; margin-left: -231px; top: 120px; background-color: rgba(0,0,0,0.75); border-radius: 10px; display: none; }
    </style>
  </head>
  <body onload="boot();">
    <canvas id="tutorial" width="1200" height="450"></canvas>
    <h1 onclick="go();">Sam & Zac</h1>
  </body>
</html>